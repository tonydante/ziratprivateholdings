Ziraat.Modules.moduleKampanyaBasvuruFormu=function(n){var t,i=function(n,t){var i={el:n,ID:t,name:"Kampanya Ba≈üvuru Formu"};Ziraat.Modules.__module.call(this,i);this.init()};return i.prototype=Object.create(Ziraat.Modules.__module.prototype),n.extend(i.prototype,{init:function(){t=this;this.moduleCache();this.eventListener()},moduleCache:function(){t.elements.$btnCampaign=n(".btn-campaign");t.elements.$endDate=t.elements.$el.find("#datePickerEnd");t.elements.$btnSend=t.elements.$el.find(".btn-red");t.elements.$formWrapper=t.elements.$el.find(".form-page-wrapper");t.elements.$phoneCode=t.elements.$el.find("#ddlPhoneCodes");t.elements.$phone=t.elements.$el.find("#phone2");t.elements.$cardNo=t.elements.$el.find("#KartNo");t.elements.$captcha=t.elements.$el.find("#captcha");t.elements.$captchaID=t.elements.$el.find("#hdnCaptchaID");t.elements.$captchaInstanceID=t.elements.$el.find("#hdnCaptchaInstanceID");n.Page.SaveKampanyaKatil=new n.Page.methodBase(siteLanguage+"/_layouts/15/Ziraat/Formlar/Ajax.aspx","SaveKampanyaKatil",{item:{TelefonKod:"String",Telefon:"String",KampanyaKodu:"String",KartNo:"String",BasvuruKanal:"String",Captcha:{CaptchaID:"String",InstanceID:"String",UserInput:"String"}}})},formSend:function(){var i={TelefonKod:t.elements.$phoneCode.val(),Telefon:t.elements.$phone.val(),KampanyaKodu:t.elements.$btnCampaign.data("code").toString(),KartNo:t.elements.$cardNo.val(),BasvuruKanal:"Web",Captcha:{CaptchaID:t.elements.$captchaID.val(),InstanceID:t.elements.$captchaInstanceID.val(),UserInput:t.elements.$captcha.val()}};n.Page.SaveKampanyaKatil(i).done(function(n){n.StatusCode==200&&n.Data.Success==!0?t.formSuccessBox(n):t.formErrorBox(n)}).fail(function(){var i=_.template(n("script.formError").html());t.elements.$formWrapper.after(i(jQuery.validator.messages.basvurumessage));t.elements.$formWrapper.hide()})},formSuccessBox:function(i){var r=_.template(n("script.formSuccess").html());t.elements.$formWrapper.hide();t.elements.$formWrapper.after(r(i.Data))},formErrorBox:function(i){var r=_.template(n("script.formError").html());t.elements.$formWrapper.find(".form-box .form-result").remove();i.StatusCode==200?(t.elements.$formWrapper.after(r(i.Data)),t.elements.$formWrapper.hide()):i.StatusCode==422?n(i.ValidationErrors).each(function(){this.PropertyName=="Captcha"?(RefreshCaptcha(),t.elements.$captcha.focus(),t.elements.$captcha.parent("div").addClass("error"),t.elements.$captcha.parent().parent(".form-item").append('<label class="error">'+jQuery.validator.messages.captchaerror+"<\/label>"),t.elements.$captcha.keyup(function(){n(this).parent(".input").next("label").eq(0).remove();n(this).parents(".form-item").removeClass("error");n(this).parents(".input").removeClass("error")})):(t.elements.$formWrapper.find("label.red").remove(),t.elements.$formWrapper.append('<label class="red">'+this.Message+"<\/label>"))}):(t.elements.$formWrapper.after(r(jQuery.validator.messages.basvurumessage)),t.elements.$formWrapper.hide())},eventListener:function(){t.elements.$btnCampaign.on("click",function(){return n("#modalCampaign").modal("show"),!1});t.elements.$btnSend.on("click",function(){if(n("form").valid())t.formSend();else return!1});n(document).on("click",".form-result .btn-group .btn-item a",function(){n(".form-result").remove();t.elements.$formWrapper.removeAttr("style");RefreshCaptcha();t.elements.$captcha.val("")});n(".form-box .input input").focusin(function(){n(this).parent(".input").addClass("focused")}).focusout(function(){n(this).parent(".input").removeClass("focused")})}}),i}(jQuery);$(document).ready(function(){ZiraatModule($("#modalCampaign"),"KampanyaBasvuruFormu")});
